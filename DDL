-------------------------------------------------------------------------------
-- USERS
-------------------------------------------------------------------------------
CREATE TABLE USERS (
    USER_ID      INT IDENTITY(1,1) PRIMARY KEY,
    USERNAME     VARCHAR(100) NOT NULL,
    PASSWORD     VARCHAR(100) NOT NULL,
    USER_GROUP   VARCHAR(100) NOT NULL
);

-------------------------------------------------------------------------------
-- BUSINESS_GROUPS
-------------------------------------------------------------------------------
CREATE TABLE BUSINESS_GROUPS (
    BUSINESS_GROUP_ID INT IDENTITY(1,1) PRIMARY KEY,
    GROUP_NAME        VARCHAR(100) NOT NULL,
    DESCRIPTION       VARCHAR(500),
    EMAIL             VARCHAR(200)
    -- If you want "GROUP_NAME" unique, you can add a unique index:
    -- CREATE UNIQUE INDEX UX_BG_NAME ON BUSINESS_GROUPS(GROUP_NAME);
);

-------------------------------------------------------------------------------
-- GROUP_PERMISSIONS
-------------------------------------------------------------------------------
CREATE TABLE GROUP_PERMISSIONS (
    PERMISSION_ID INT IDENTITY(1,1) PRIMARY KEY,
    GROUP_NAME    VARCHAR(100) NOT NULL,
    TARGET_TABLE  VARCHAR(255) NOT NULL
);

-------------------------------------------------------------------------------
-- BRM_RULE_TYPES
-------------------------------------------------------------------------------
CREATE TABLE BRM_RULE_TYPES (
    RULE_TYPE_ID   INT IDENTITY(1,1) PRIMARY KEY,
    RULE_TYPE_NAME VARCHAR(200) NOT NULL
);

-------------------------------------------------------------------------------
-- BRM_RULE_GROUPS
-------------------------------------------------------------------------------
CREATE TABLE BRM_RULE_GROUPS (
    GROUP_ID   INT IDENTITY(1,1) PRIMARY KEY,
    GROUP_NAME VARCHAR(200) NOT NULL
);

-------------------------------------------------------------------------------
-- BRM_RULES
-------------------------------------------------------------------------------
CREATE TABLE BRM_RULES (
    RULE_ID                INT IDENTITY(1,1) PRIMARY KEY,
    GROUP_ID               INT,
    PARENT_RULE_ID         INT,
    RULE_TYPE_ID           INT,
    RULE_NAME              VARCHAR(200) NOT NULL,
    RULE_SQL               VARCHAR(MAX),
    EFFECTIVE_START_DATE   DATETIME,
    EFFECTIVE_END_DATE     DATETIME,
    STATUS                 VARCHAR(50),
    VERSION                INT DEFAULT 1,
    CREATED_BY             VARCHAR(100),
    DESCRIPTION            VARCHAR(MAX),
    OPERATION_TYPE         VARCHAR(50),
    BUSINESS_JUSTIFICATION VARCHAR(MAX),
    CREATED_TIMESTAMP      DATETIME,
    UPDATED_BY             VARCHAR(100),
    OWNER_GROUP            VARCHAR(100),
    CLUSTER_NAME           VARCHAR(100),
    APPROVAL_STATUS        VARCHAR(50),
    IS_GLOBAL              BIT       DEFAULT 0,
    CRITICAL_RULE          BIT       DEFAULT 0,
    CRITICAL_SCOPE         VARCHAR(50),
    CDC_TYPE               VARCHAR(50),
    LIFECYCLE_STATE        VARCHAR(50),
    DECISION_TABLE_ID      INT
);

-------------------------------------------------------------------------------
-- BRM_RULE_TABLE_DEPENDENCIES
-------------------------------------------------------------------------------
CREATE TABLE BRM_RULE_TABLE_DEPENDENCIES (
    DEPENDENCY_ID INT IDENTITY(1,1) PRIMARY KEY,
    RULE_ID       INT NOT NULL,
    DATABASE_NAME VARCHAR(100),
    TABLE_NAME    VARCHAR(255),
    COLUMN_NAME   VARCHAR(255),
    COLUMN_OP     VARCHAR(50)
);

-------------------------------------------------------------------------------
-- BRM_AUDIT_LOG
-------------------------------------------------------------------------------
CREATE TABLE BRM_AUDIT_LOG (
    AUDIT_ID         INT IDENTITY(1,1) PRIMARY KEY,
    ACTION           VARCHAR(100) NOT NULL,
    TABLE_NAME       VARCHAR(100),
    RECORD_ID        VARCHAR(100),
    ACTION_BY        VARCHAR(100),
    OLD_DATA         VARCHAR(MAX),
    NEW_DATA         VARCHAR(MAX),
    ACTION_TIMESTAMP DATETIME DEFAULT GETDATE()
);

-------------------------------------------------------------------------------
-- BRM_RULE_LINEAGE
-------------------------------------------------------------------------------
CREATE TABLE BRM_RULE_LINEAGE (
    LINEAGE_ID    INT IDENTITY(1,1) PRIMARY KEY,
    RULE_ID       INT NOT NULL,
    LINEAGE_DATA  VARCHAR(MAX)
);

-------------------------------------------------------------------------------
-- BRM_GROUP_BACKUPS
-------------------------------------------------------------------------------
CREATE TABLE BRM_GROUP_BACKUPS (
    BACKUP_ID       INT IDENTITY(1,1) PRIMARY KEY,
    GROUP_ID        INT NOT NULL,
    BACKUP_TIMESTAMP DATETIME DEFAULT GETDATE(),
    BACKUP_JSON     VARCHAR(MAX)
);

-------------------------------------------------------------------------------
-- BRM_COLUMN_MAPPING
-------------------------------------------------------------------------------
CREATE TABLE BRM_COLUMN_MAPPING (
    COLUMN_MAP_ID   INT IDENTITY(1,1) PRIMARY KEY,
    SOURCE_RULE_ID  INT NOT NULL,
    TARGET_RULE_ID  INT NOT NULL,
    MAPPING_DETAILS VARCHAR(MAX)
);

-------------------------------------------------------------------------------
-- BRM_CUSTOM_RULE_GROUPS
-------------------------------------------------------------------------------
CREATE TABLE BRM_CUSTOM_RULE_GROUPS (
    CUSTOM_GROUP_ID       INT IDENTITY(1,1) PRIMARY KEY,
    CUSTOM_GROUP_NAME     VARCHAR(200) NOT NULL,
    OWNER_BUSINESS_GROUP  VARCHAR(100),
    CREATED_BY            VARCHAR(100),
    CREATED_TIMESTAMP     DATETIME DEFAULT GETDATE()
);

-------------------------------------------------------------------------------
-- BRM_CUSTOM_GROUP_MEMBERS
-------------------------------------------------------------------------------
CREATE TABLE BRM_CUSTOM_GROUP_MEMBERS (
    CGM_ID          INT IDENTITY(1,1) PRIMARY KEY,
    CUSTOM_GROUP_ID INT NOT NULL,
    RULE_ID         INT NOT NULL
);

-------------------------------------------------------------------------------
-- BUSINESS_GROUP_APPROVERS
-------------------------------------------------------------------------------
CREATE TABLE BUSINESS_GROUP_APPROVERS (
    APPROVER_ID INT IDENTITY(1,1) PRIMARY KEY,
    GROUP_NAME  VARCHAR(100) NOT NULL,
    USERNAME    VARCHAR(100) NOT NULL
);

-------------------------------------------------------------------------------
-- BRM_RULE_APPROVALS
-------------------------------------------------------------------------------
CREATE TABLE BRM_RULE_APPROVALS (
    APPROVAL_ID       INT IDENTITY(1,1) PRIMARY KEY,
    RULE_ID           INT NOT NULL,
    GROUP_NAME        VARCHAR(100),
    USERNAME          VARCHAR(100),
    APPROVED_FLAG     INT DEFAULT 0,
    APPROVED_TIMESTAMP DATETIME,
    APPROVAL_STAGE    INT
);

-------------------------------------------------------------------------------
-- BRM_CUSTOM_GROUP_BACKUPS
-------------------------------------------------------------------------------
CREATE TABLE BRM_CUSTOM_GROUP_BACKUPS (
    BACKUP_ID         INT IDENTITY(1,1) PRIMARY KEY,
    CUSTOM_GROUP_ID   INT NOT NULL,
    BACKUP_TIMESTAMP  DATETIME DEFAULT GETDATE(),
    BACKUP_VERSION    INT,
    BACKUP_JSON       VARCHAR(MAX)
);

-------------------------------------------------------------------------------
-- BRM_GLOBAL_CRITICAL_LINKS
-------------------------------------------------------------------------------
CREATE TABLE BRM_GLOBAL_CRITICAL_LINKS (
    LINK_ID       INT IDENTITY(1,1) PRIMARY KEY,
    GCR_RULE_ID   INT NOT NULL,
    TARGET_RULE_ID INT NOT NULL
);

-------------------------------------------------------------------------------
-- RULE_SCHEDULES
-------------------------------------------------------------------------------
CREATE TABLE RULE_SCHEDULES (
    SCHEDULE_ID      INT IDENTITY(1,1) PRIMARY KEY,
    RULE_ID          INT NOT NULL,
    SCHEDULE_TIME    DATETIME NOT NULL,
    STATUS           VARCHAR(50) NOT NULL,
    CREATED_TIMESTAMP DATETIME DEFAULT GETDATE()
);

-------------------------------------------------------------------------------
-- BRM_RULE_COMMENTS
-------------------------------------------------------------------------------
CREATE TABLE BRM_RULE_COMMENTS (
    COMMENT_ID       INT IDENTITY(1,1) PRIMARY KEY,
    RULE_ID          INT NOT NULL,
    COMMENT_TEXT     VARCHAR(MAX),
    COMMENT_BY       VARCHAR(100),
    COMMENT_TIMESTAMP DATETIME DEFAULT GETDATE()
);

-------------------------------------------------------------------------------
-- DECISION_TABLES
-------------------------------------------------------------------------------
CREATE TABLE DECISION_TABLES (
    DECISION_TABLE_ID INT IDENTITY(1,1) PRIMARY KEY,
    TABLE_NAME        VARCHAR(200) NOT NULL,
    DESCRIPTION       VARCHAR(MAX)
);

-------------------------------------------------------------------------------
-- RULE_CONFLICTS
-------------------------------------------------------------------------------
CREATE TABLE RULE_CONFLICTS (
    CONFLICT_ID INT IDENTITY(1,1) PRIMARY KEY,
    RULE_ID1    INT NOT NULL,
    RULE_ID2    INT NOT NULL,
    PRIORITY    INT
);

-------------------------------------------------------------------------------
-- COMPOSITE_RULES
-------------------------------------------------------------------------------
CREATE TABLE COMPOSITE_RULES (
    COMPOSITE_RULE_ID INT IDENTITY(1,1) PRIMARY KEY,
    CRULE_NAME        VARCHAR(200) NOT NULL,
    LOGIC_EXPR        VARCHAR(MAX),
    ACTION_ON_PASS    VARCHAR(MAX)
);

-------------------------------------------------------------------------------
-- RULE_SNAPSHOTS
-------------------------------------------------------------------------------
CREATE TABLE RULE_SNAPSHOTS (
    SNAPSHOT_ID       INT IDENTITY(1,1) PRIMARY KEY,
    SNAPSHOT_NAME     VARCHAR(200) NOT NULL,
    CREATED_BY        VARCHAR(100),
    CREATED_TIMESTAMP DATETIME DEFAULT GETDATE(),
    SNAPSHOT_JSON     VARCHAR(MAX)
);

-------------------------------------------------------------------------------
-- RULE_TAGS
-------------------------------------------------------------------------------
CREATE TABLE RULE_TAGS (
    TAG_ID  INT IDENTITY(1,1) PRIMARY KEY,
    RULE_ID INT NOT NULL,
    TAG_NAME VARCHAR(200) NOT NULL
);

-------------------------------------------------------------------------------
-- DATA_VALIDATIONS
-------------------------------------------------------------------------------
CREATE TABLE DATA_VALIDATIONS (
    VALIDATION_ID   INT IDENTITY(1,1) PRIMARY KEY,
    TABLE_NAME      VARCHAR(200),
    COLUMN_NAME     VARCHAR(200),
    VALIDATION_TYPE VARCHAR(100),
    PARAMS          VARCHAR(MAX)
);

-------------------------------------------------------------------------------
-- RULE_EXECUTION_LOGS
-------------------------------------------------------------------------------
CREATE TABLE RULE_EXECUTION_LOGS (
    EXEC_ID            INT IDENTITY(1,1) PRIMARY KEY,
    RULE_ID            INT NOT NULL,
    EXECUTION_TIMESTAMP DATETIME DEFAULT GETDATE(),
    PASS_FLAG          BIT,
    MESSAGE            VARCHAR(MAX),
    RECORD_COUNT       INT
);

-------------------------------------------------------------------------------
-- USAGE_STATS
-------------------------------------------------------------------------------
CREATE TABLE USAGE_STATS (
    USAGE_ID          INT IDENTITY(1,1) PRIMARY KEY,
    CAPTURE_TIMESTAMP DATETIME DEFAULT GETDATE(),
    USER_ID           INT NOT NULL,
    ACTION            VARCHAR(100),
    NOTES             VARCHAR(MAX)
);

-------------------------------------------------------------------------------
-- BRM_RULE_LOCKS
-------------------------------------------------------------------------------
CREATE TABLE BRM_RULE_LOCKS (
    LOCK_ID      INT IDENTITY(1,1) PRIMARY KEY,
    RULE_ID      INT NOT NULL,
    LOCKED_BY    VARCHAR(100) NOT NULL,
    LOCK_TIMESTAMP DATETIME DEFAULT GETDATE()
);


DROP TABLE BRM_RULE_LOCKS;
DROP TABLE USAGE_STATS;
DROP TABLE RULE_EXECUTION_LOGS;
DROP TABLE DATA_VALIDATIONS;
DROP TABLE RULE_TAGS;
DROP TABLE RULE_SNAPSHOTS;
DROP TABLE COMPOSITE_RULES;
DROP TABLE RULE_CONFLICTS;
DROP TABLE DECISION_TABLES;
DROP TABLE BRM_RULE_COMMENTS;
DROP TABLE RULE_SCHEDULES;
DROP TABLE BRM_GLOBAL_CRITICAL_LINKS;
DROP TABLE BRM_CUSTOM_GROUP_BACKUPS;
DROP TABLE BRM_RULE_APPROVALS;
DROP TABLE BUSINESS_GROUP_APPROVERS;
DROP TABLE BRM_CUSTOM_GROUP_MEMBERS;
DROP TABLE BRM_CUSTOM_RULE_GROUPS;
DROP TABLE BRM_COLUMN_MAPPING;
DROP TABLE BRM_GROUP_BACKUPS;
DROP TABLE BRM_RULE_LINEAGE;
DROP TABLE BRM_AUDIT_LOG;
DROP TABLE BRM_RULE_TABLE_DEPENDENCIES;
DROP TABLE BRM_RULES;
DROP TABLE BRM_RULE_GROUPS;
DROP TABLE BRM_RULE_TYPES;
DROP TABLE GROUP_PERMISSIONS;
DROP TABLE BUSINESS_GROUPS;
DROP TABLE USERS;